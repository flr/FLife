Mobula Mobula; power analysis
========================================================
  
```{r, echo=FALSE}
library(knitr)

opts_chunk$set(comment=NA, fig.width =6, 
               fig.height=6,
               fig.path  ="../tex/mobula",
               warnings=FALSE, 
               message =FALSE, 
               error   =FALSE, 
               echo    =FALSE,
               cache   =FALSE)
```

```{r}
library(popbio)
library(fishmethods)
library(ggplotFL)
library(FLBRP)
library(FLife)
library(akima)
```

### Power Analysis contours
pws=rbind(data.frame(Freq=1,transform(tmp,                 r=log(1+R/100)/maxyrs)),
          data.frame(Freq=2,transform(tmp, maxyrs=maxyrs*2,r=log(1+R/100)/(maxyrs*2))),
          data.frame(Freq=3,transform(tmp, maxyrs=maxyrs*3,r=log(1+R/100)/(maxyrs*3))))

pws=transform(subset(pws, power<.7 & power>.5), Increasing=ifelse(r>0,TRUE,FALSE))

p.=ddply(pws,.(Freq,PSE,Increasing), function(dat,power=0.6){  
  # linear interpolation at points (1,2), (5,6) and (10,12)
  akima.lip<-interpp(dat$maxyrs, dat$power, dat$r, seq(1,30,1),rep(power,30),duplicate="mean")
  data.frame(Year=akima.lip$x,r=akima.lip$z)})

p.=transform(p.,grp=paste(Freq,PSE,ac(Increasing)),CV=factor(PSE),Interval=factor(Freq))

ggplot(p.)+geom_line(aes(Year,r,group=grp,col=CV,linetype=Interval))+
  #geom_hline(aes(yintercept=gR,col=names(gR))) + theme_ms(10) + 
  geom_hline(aes(yintercept=seq(-.2,.2,.1)),linetype=2) + theme_ms(10) + 
  geom_vline(aes(xintercept=seq(1,30,1)),linetype=2)+
  ylab("Population Growth Rate (r)")        +
  xlab("Year of Survey")

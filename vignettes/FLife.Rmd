---
title: "Life History Relationships"
author: "Laurence Kell"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_vignette: default
  pdf_document: default
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
bibliography: ref.bib
tags: FLPKG FLR
license: Creative Commons Attribution-ShareAlike 4.0 International
---

```{r knitr_init, echo=FALSE, results="hide"}
library(knitr)
## Global options
opts_chunk$set(echo    =!TRUE,
               eval    =TRUE,
               prompt  =FALSE,
               comment =NA,
               message =FALSE,
               warning =FALSE,
               tidy    =FALSE,
               fig.height=4.5,
               fig.width =4.5)

iFig=0
```


```{r, pkgs, echo=FALSE, message=FALSE}
warn=options()$warn
options(warn=-1)
library(ggplot2)
library(`FLife`)

theme_set(theme_bw())
options(digits=3)
options(warn=warn)
```

[](#top)

[Introduction](#Introduction)

[Installation](#Installation)

[Quick Start](#QuickStart)

[Methods](#Methods)

[Catch curves](#Catch curves)

[Simulation](#Simulation)

[More information](#More information)

[References](#References)

# Introduction {#Introduction}

Many studies have shown the relationships between life history traits for processes such as growth, maturity and natural mortality. Life history has been used to develop priors in stock assesments and to parameterise ecological models. The `FLife` package has a variety of methods for modelling life history traits and processes for use in fish stock assessment and Management Strategy Evaluation (MSE). 

[Back to Top](#top)

# Installation {#Installation}

The simplest way to obtain `FLife` is to install it from the `FLR` repository via the R console:

```{r install,echo=TRUE,eval=FALSE}
install.packages("FLife", repos = "http://flr-project.org/R")
```

The repos options can be changed depending on personal preferences and includes options such as choosing the directories in which to install the packages see help(install.packages) for more details.

[Back to Top](#top)

# Quick Start {#QuickStart}

This section provide a quick overview of what functions are available, potential usage, and where to seek help. More details are given in later sections.

First, load the `FLife` package:

```{r lib,echo=TRUE}
library(FLife)
```

There is an example teleost dataset, used for illustration and as a test dataset, alternatively users can load their own data.

```{r data-yft,echo=TRUE}
data(teleost)
```

The dataset contains life history parameters i.e. von Bertalanffy growth parameters ($L_{\infty}, k, t_0$), length at 50\% mature ($L_{50}$), and for the length weight relationship ($a, b$) for a range of bony fish species and families.  

```{r data-yft2,echo=TRUE}
head(teleost)
```

### Plotting

In the package plotting is done using `ggplot2` which provides a powerful alternative paradigm for creating both simple and complex plots in R using the ideas the *Grammar of Graphics* ^[Wilkinson, L. 1999. *The Grammar of Graphics*, Springer. [doi 10.1007/978-3-642-21551-3_13](http://dx.doi.org/10.1007/978-3-642-21551-3_13).] The idea of the grammar is to specify the individual building blocks of a plot and then to combine them to create the graphic desired^[<http://tutorials.iq.harvard.edu/R/Rgraphics/Rgraphics.html>].

The `ggplot` functions expects a `data.frame` for its first argument, `data`; then a geometric object `geom` that specifies the actual marks put on to a plot and an aesthetic that is "something you can see" have to be provided. Examples of geometic Objects (geom) include points (geom_point, for scatter plots, dot plots, etc), lines (geom_line, for time series, trend lines, etc) and boxplot (geom_boxplot, for, well, boxplots!). Aesthetic mappings are set with the aes() function and, examples include, position (i.e., on the x and y axes), color ("outside" color), fill ("inside" color), shape (of points), linetype and size. 


```{r}
library(reshape2)
library(ggplotFL)

ggplot(melt(model.frame(teleost[c("linf","k","b","l50")])))+
  geom_histogram(aes(x=value))+
  facet_wrap(~variable,scale="free")
```

**Figure `r iFig=iFig+1; iFig`.** Life history parameters in teleost dataset.

```{r}
age=FLQuant(1:20,dimnames=list(age=1:20))
len=vonB(age,teleost)

ggplot(as.data.frame(len))+
  geom_line(aes(age,data,col=iter))+
  theme(legend.position="none")
```

**Figure `r iFig=iFig+1; iFig`.** Von Bertalanffy growth curve. 

[Back to Top](#top)


[Methods](#Methods)

There are a variety of methods for creating growth curves, maturity ogives, natural mortality vectors and selection patterns.


```{r}
alb=teleost[,attributes(teleost)$species=="Thunnus alalunga"]

vectors=FLQuants(Growth   =vonB(age,alb),
                 M        =gislason(age,alb),
                 Maturity =logistic(age,alb),
                 Selection=dnormal(age,alb))

ggplot(vectors) +
  geom_line(aes(age,data))+
  facet_wrap(~qname,scale="free")
```

**Figure `r iFig=iFig+1; iFig`.** Age-vectors of growthm natural mortality, maturity and selection pattern.

## Life History

Generation of missing life history relationships

```{r}
par=lhPar(FLPar(linf=100))
par
```

Simulation of equilibrium values and reference points

```{r}
library(FLBRP)
eql=lhEql(par)

ggplot(FLQuants(eql,"m","catch.sel","mat","catch.wt"))+
  geom_line(aes(age,data))+
  facet_wrap(~qname,scale="free")
```

**Figure `r iFig=iFig+1; iFig`.** Age-vectors of growthm natural mortality, maturity and selection pattern.

```{r}
plot(eql)
```

**Figure `r iFig=iFig+1; iFig`.** Equilibrium curves and reference points.

```{r}
lhRef(par)
```

**Figure `r iFig=iFig+1; iFig`.** Population parameters.

[Back to Top](#top)

[Catch curves](#Catch curves)

```{r}
data(ple4)
ctc=as.data.frame(catch.n(ple4))
dat=cc(age=ctc$age,n=ctc$data)
head(dat)
```

```{r}
data(cas)
pw=ddply(subset(cas), .(year), 
   function(cas) powh(cas$len,cas$n)$data)
   
   pw=transform(pw, lustrum=(year%/%5)*5,
         yr    =year-(year%/%5)*5,
         weight=ifelse(len>=100&len<=200,1,0))
         
ggplot(pw)+
   geom_line(aes(len,diff,colour=factor(yr),group=year))+
   scale_x_continuous(limits=c(0,300)) +
   xlab("Length (cm)")+
   ylab("Difference between Length and Mean Size")+
   geom_smooth(aes(len,diff,weight=weight),
   method="lm",col="red",size=1.25,alpha=.1)+
   theme_bw()+theme(legend.position="none")
```


[Back to Top](#top)

[Simulation](#Simulation)

[Back to Top](#top)

[More information](#More information)

* You can submit bug reports, questions or suggestions on `FLPKG` at the `FLPKG` issue page ^[<https://github.com/flr/FLPKG/issues>], or on the *FLR* mailing list.
* Or send a pull request to <https://github.com/flr/FLPKG/>
* For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage ^[<http://flr-project.org>].
* The latest version of `FLPKG` can always be installed using the `devtools` package, by calling
```{r, devtools, echo=TRUE, eval=FALSE}
	library(devtools)
	install_github('flr/FLPKG')
```
`

## Software Versions

* `r version$version.string`
* FLCore: `r packageVersion('FLCore')`
* FLPKG: `r # packageVersion('FLPKG')`
* **Compiled**: `r date()`
* **Git Hash**: `r system("git log --pretty=format:'%h' -n 1", intern=TRUE)`

## Author information

**Laurence KELL**. laurie@kell.es

# References {#References}


[Back to Top](#top)
